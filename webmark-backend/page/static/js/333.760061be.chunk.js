(self.webpackChunkwebmark=self.webpackChunkwebmark||[]).push([[333],{477:()=>{},3743:()=>{},6057:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>I});var o=n(1957),r=n(5043),a=n(1234),s=n(2019),i=n(6385),c=n(1982),l=n(898),d=n(1389),p=n(322),h=n(6551),u=n(2054),m=n(6011),x=n(2058),f=n(9933),j=n(5885),y=n(1966),g=n(8143),A=n(290),v=n(1675),w=(n(3549),n(3211)),k=(n(3318),n(5539),n(5890)),C=(n(9816),n(3814)),E=n(7184),$=n(3223),S=(n(3743),n(9251)),b=n(6111),T=n.n(b),L=n(579);const N={height:60,paddingInline:30,lineHeight:"30px",backgroundColor:"#fff"},{Header:D,Content:P,Sider:O}=a.A,R=e=>({remark:t=>t.use((()=>t=>{(0,S.YR)(t,["image","link"],(t=>{"string"!==typeof t.url||t.url.startsWith("http")||(t.url=`/wmapi/markdown/${e}/${t.url.replace(/^\/+/,"")}`)}))}))}),F=e=>{let{onUpload:t}=e;return{editorEffect:e=>{let{editor:n}=e;const o=n,r=o.getWrapperElement(),a=e=>{e.preventDefault(),e.stopPropagation()},s=async e=>{a(e);const n=Array.from(e.dataTransfer.files);for(const r of n){const e=await t(r);let n=r.type.startsWith("image/")?`![](${e})`:`[${r.name}](${e})`;o.replaceSelection(n+"\n")}},i=async e=>{const n=e.clipboardData.items;if(n)for(const r of n)if("file"===r.kind){const n=r.getAsFile();if(!n)continue;const a=await t(n);let s=n.type.startsWith("image/")?`![](${a})`:`[${n.name}](${a})`;o.replaceSelection(s+"\n"),e.preventDefault()}};return r.addEventListener("dragover",a),r.addEventListener("drop",s),r.addEventListener("paste",i),()=>{r.removeEventListener("dragover",a),r.removeEventListener("drop",s),r.removeEventListener("paste",i)}}}},I=()=>{const[e]=(0,v.ok)(),t=e.get("groupname"),n=[(0,E.A)({locale:$}),{rehype:e=>e.use((()=>e=>{(0,S.YR)(e,"element",((e,t,n)=>{var r,a;if("pre"===e.tagName&&"code"===(null===(r=e.children)||void 0===r||null===(a=r[0])||void 0===a?void 0:a.tagName)){const t=e.children[0].children.map((e=>e.value||"")).join("");e.children.push((0,o.h)("button",{type:"button",class:"copy-btn","data-code":t,title:"\u590d\u5236\u4ee3\u7801"},"\ud83d\udccb")),e.properties.className=(e.properties.className||[]).concat("with-copy")}if("code"===e.tagName&&"pre"!==(null===n||void 0===n?void 0:n.tagName)){const r=e.children.map((e=>e.value||"")).join("");n.children[t]=(0,o.h)("span",{class:"inline-code-wrapper"},[e,(0,o.h)("button",{type:"button",class:"inline-copy-btn","data-code":r,title:"\u590d\u5236\u4ee3\u7801"},"\ud83d\udccb")])}}))}))},(0,w.A)(),R(t),F({onUpload:e=>new Promise(((n,o)=>{if(e){var r=new FormData,a=`${Date.now()}_${e.name}`;r.append("file",e,a);var s=new XMLHttpRequest;s.upload.addEventListener("progress",(e=>{if(e.lengthComputable){var t=e.loaded/e.total*100;t=parseInt(t),console.log("\u4e0a\u4f20\u8fdb\u5ea6\uff1a"+t+"%")}})),s.addEventListener("load",(e=>{console.log("\u4e0a\u4f20\u5b8c\u6210"),n(`${B}/${a}`)})),s.addEventListener("error",(e=>{console.log("\u4e0a\u4f20\u51fa\u9519")})),s.addEventListener("abort",(e=>{console.log("\u4e0a\u4f20\u53d6\u6d88")})),s.open("POST",`/wmapi/upload/${t}/${B}`),s.send(r)}}))})],[b,I]=(0,r.useState)(""),[W,H]=(0,r.useState)([]),[K,U]=(0,r.useState)({}),[q,M]=(0,r.useState)(!1),[Y,_]=(0,r.useState)(""),[z,G]=(0,r.useState)(!1),[J,X]=(0,r.useState)(""),[B,Q]=(0,r.useState)(""),[V,Z]=(0,r.useState)(!1),[ee,te]=s.Ay.useMessage(),ne=(0,r.useRef)(J),oe=(0,r.useRef)(B);(0,r.useEffect)((()=>{ne.current=J}),[J]),(0,r.useEffect)((()=>{oe.current=B}),[B]),(0,r.useEffect)((()=>{const e=e=>{const t=e.target.closest(".copy-btn, .inline-copy-btn");if(t){const e=t.getAttribute("data-code");navigator.clipboard.writeText(e).then((()=>{t.textContent="\u2705",setTimeout((()=>{t.textContent="\ud83d\udccb"}),1500)}))}};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[J]);const re=()=>{fetch("/wmapi/search-detail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:t,query:b})}).then((e=>e.json())).then((e=>{e.ok?(H(e.data),e.data&&se(e.data[0])()):ee.open({type:"error",content:e.msg})}))};(0,r.useEffect)(re,[]);const ae=()=>{fetch(`/wmapi/update-markdown/${t}/${oe.current}`,{method:"POST",headers:{"Content-Type":"application/text"},body:ne.current}).then((e=>e.json())).then((e=>{e.ok?ee.open({type:"success",content:"\u4fdd\u5b58\u6210\u529f"}):ee.open({type:"error",content:e.msg})}))},se=e=>()=>{e&&(Q(e),fetch(`/wmapi/markdown/${t}/${e}.md?_t=${Date.now()}`,{method:"GET",headers:{"Cache-Control":"no-cache"}}).then((e=>e.text())).then((e=>{X(e),Z(!0)})))};return(0,L.jsxs)(L.Fragment,{children:[te,(0,L.jsx)(i.A,{title:"\u65b0\u5efa\u6587\u6863",open:q,onOk:()=>{fetch(`/wmapi/new-markdown/${t}/${K.mdname}`,{method:"POST",headers:{"Content-Type":"application/text"},body:"## \u64cd\u4f5c\u4ecb\u7ecd\n* Ctrl+S\u4fdd\u5b58\n* \u56fe\u7247\u652f\u6301\u590d\u5236\u7c98\u8d34\u3001\u62d6\u62fd"}).then((e=>e.json())).then((e=>{e.ok?(re(),M(!1)):ee.open({type:"error",content:e.msg})}))},onCancel:()=>{M(!1)},children:(0,L.jsx)(c.A,{placeholder:"\u6587\u6863\u540d\u79f0",value:K.mdname,onChange:e=>{U({mdname:e.target.value})}})}),(0,L.jsx)(i.A,{title:"\u52a0\u89e3\u5bc6",open:z,onOk:()=>{G(!1)},onCancel:()=>{G(!1)},children:(0,L.jsxs)(l.A,{direction:"vertical",children:[(0,L.jsx)(c.A.Password,{placeholder:"\u5bc6\u7801",value:Y,onChange:e=>{_(e.target.value)}}),(0,L.jsxs)(l.A,{children:[(0,L.jsx)(d.Ay,{type:"primary",onClick:()=>{var e=T().AES.encrypt(J,Y).toString();X(e)},children:"\u52a0\u5bc6"}),(0,L.jsx)(d.Ay,{onClick:()=>{var e=T().AES.decrypt(J,Y).toString(T().enc.Utf8);X(e)},children:"\u89e3\u5bc6"})]})]})}),(0,L.jsxs)(a.A,{className:"layout",children:[(0,L.jsx)(D,{className:"header",children:(0,L.jsxs)(l.A,{children:[t,(0,L.jsx)(d.Ay,{icon:(0,L.jsx)(m.A,{}),onClick:()=>{window.location.href="/"},children:"\u9996\u9875"}),(0,L.jsxs)(l.A.Compact,{style:{width:"100%"},children:[(0,L.jsx)(c.A,{onKeyDown:e=>{"Enter"===e.code&&re()},value:b,placeholder:"\u5173\u952e\u8bcd",onChange:e=>I(e.target.value)}),(0,L.jsx)(d.Ay,{onClick:re,icon:(0,L.jsx)(x.A,{}),children:"\u641c\u7d22"})]}),(0,L.jsx)(d.Ay,{icon:(0,L.jsx)(f.A,{}),onClick:()=>{M(!0)},children:"\u65b0\u5efa\u6587\u6863"}),(0,L.jsx)(d.Ay,{icon:(0,L.jsx)(j.A,{}),onClick:()=>{window.open(`/wmapi/export/${t}`)},children:"\u5bfc\u51fa\u5206\u7ec4"}),(0,L.jsx)(p.A,{title:"\u5220\u9664\u5206\u7ec4",description:"\u786e\u8ba4\u5220\u9664\u5206\u7ec4\uff1f",onConfirm:e=>{fetch(`/wmapi/del-group/${t}`,{method:"DELETE"}).then((e=>e.text())).then((e=>{window.location.href="/"}))},onCancel:e=>{},okText:"\u662f",cancelText:"\u5426",children:(0,L.jsx)(d.Ay,{danger:!0,icon:(0,L.jsx)(y.A,{}),children:"\u5220\u9664\u5206\u7ec4"})})]})}),(0,L.jsx)(P,{className:"content",children:(0,L.jsxs)(h.A,{children:[(0,L.jsx)(h.A.Panel,{defaultSize:"15%",max:"70%",children:(0,L.jsx)(u.A,{style:{height:"750px"},dataSource:W,renderItem:e=>(0,L.jsx)(u.A.Item,{children:(0,L.jsx)(d.Ay,{type:"link",onClick:se(e),children:e})})})}),(0,L.jsx)(h.A.Panel,{children:V?(0,L.jsxs)(a.A,{children:[(0,L.jsx)(D,{style:N,children:(0,L.jsxs)(a.A,{style:{backgroundColor:"#fff"},children:[(0,L.jsx)(P,{children:(0,L.jsx)("h1",{children:B})}),(0,L.jsx)(O,{width:"40%",style:{backgroundColor:"#fff"},children:(0,L.jsxs)(l.A,{children:[(0,L.jsx)(d.Ay,{icon:(0,L.jsx)(g.A,{}),type:"primary",onClick:ae,children:"\u4fdd\u5b58"}),(0,L.jsx)(d.Ay,{icon:(0,L.jsx)(A.A,{}),onClick:()=>{G(!0)},children:"\u52a0\u89e3\u5bc6"}),(0,L.jsx)(d.Ay,{icon:(0,L.jsx)(j.A,{}),onClick:()=>{window.open(`/wmapi/export/${t}/${B}`)},children:"\u5bfc\u51fa"}),(0,L.jsx)(p.A,{title:"\u5220\u9664\u6587\u7ae0",description:"\u786e\u8ba4\u5220\u9664\u6587\u6863\uff1f",onConfirm:e=>{Q(""),fetch(`/wmapi/del-markdown/${t}/${B}`,{method:"DELETE"}).then((e=>e.text())).then((e=>{X(""),re()}))},onCancel:e=>{},okText:"\u662f",cancelText:"\u5426",children:(0,L.jsx)(d.Ay,{danger:!0,icon:(0,L.jsx)(y.A,{}),children:"\u5220\u9664"})})]})})]})}),(0,L.jsx)(P,{children:(0,L.jsx)(k.K,{value:J,plugins:n,onChange:e=>{X(e)},editorConfig:{lineNumbers:!0,autofocus:!1,extraKeys:{"Ctrl-S":()=>(ae(),!0)}},locale:C})})]}):(0,L.jsx)(L.Fragment,{})})]})})]})]})}}}]);
//# sourceMappingURL=333.760061be.chunk.js.map