(self.webpackChunkwebmark=self.webpackChunkwebmark||[]).push([[333],{16057:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>U});var o=n(41957),r=n(65043),a=n(21234),s=n(22019),i=n(36385),c=n(41982),l=n(10898),d=n(11389),h=n(40322),p=n(6551),u=n(62054),m=n(46011),x=n(62058),f=n(9933),j=n(65885),y=n(61966),g=n(88143),A=n(80290),v=n(91675),w=n(92737),C=n(94847),k=(n(43549),n(3211)),E=(n(33318),n(55539),n(53536)),$=n(36860),S=n(87456),b=(n(99816),n(63814)),T=n(88502),L=n(53223),N=(n(73743),n(19251)),D=n(86111),P=n.n(D),O=n(70579);const R={height:60,paddingInline:30,lineHeight:"30px",backgroundColor:"#fff"},{Header:F,Content:I,Sider:W}=a.A,H=e=>({remark:t=>t.use((()=>t=>{(0,N.YR)(t,["image","link"],(t=>{"string"!==typeof t.url||t.url.startsWith("http")||(t.url=`${e}/${t.url.replace(/^\/+/,"")}`)}))}))}),K=e=>{let{onUpload:t}=e;return{editorEffect:e=>{let{editor:n}=e;const o=n,r=o.getWrapperElement(),a=e=>{e.preventDefault(),e.stopPropagation()},s=async e=>{a(e);const n=Array.from(e.dataTransfer.files);for(const r of n){const e=await t(r);let n=r.type.startsWith("image/")?`![](${e})`:`[${r.name}](${e})`;o.replaceSelection(n+"\n")}},i=async e=>{const n=e.clipboardData.items;if(n)for(const r of n)if("file"===r.kind){const n=r.getAsFile();if(!n)continue;const a=await t(n);let s=n.type.startsWith("image/")?`![](${a})`:`[${n.name}](${a})`;o.replaceSelection(s+"\n"),e.preventDefault()}};return r.addEventListener("dragover",a),r.addEventListener("drop",s),r.addEventListener("paste",i),()=>{r.removeEventListener("dragover",a),r.removeEventListener("drop",s),r.removeEventListener("paste",i)}}}},U=()=>{const[e]=(0,v.ok)(),t=e.get("groupname"),n=[(0,T.A)({locale:L}),{rehype:e=>e.use((()=>e=>{(0,N.YR)(e,"element",((e,t,n)=>{var r,a;if("pre"===e.tagName&&"code"===(null===(r=e.children)||void 0===r||null===(a=r[0])||void 0===a?void 0:a.tagName)){const t=e.children[0].children.map((e=>e.value||"")).join("");e.children.push((0,o.h)("button",{type:"button",class:"copy-btn","data-code":t,title:"\u590d\u5236\u4ee3\u7801"},"\ud83d\udccb")),e.properties.className=(e.properties.className||[]).concat("with-copy")}if("code"===e.tagName&&"pre"!==(null===n||void 0===n?void 0:n.tagName)){const r=e.children.map((e=>e.value||"")).join("");n.children[t]=(0,o.h)("span",{class:"inline-code-wrapper"},[e,(0,o.h)("button",{type:"button",class:"inline-copy-btn","data-code":r,title:"\u590d\u5236\u4ee3\u7801"},"\ud83d\udccb")])}}))}))},(0,k.A)(),(0,w.A)({locale:C,katexOptions:{output:"mathml"}}),(0,E.A)({locale:$}),H(t),K({onUpload:e=>new Promise(((n,o)=>{if(e){var r=new FormData,a=`${Date.now()}_${e.name}`;r.append("file",e,a);var s=new XMLHttpRequest;s.upload.addEventListener("progress",(e=>{if(e.lengthComputable){var t=e.loaded/e.total*100;t=parseInt(t),console.log("\u4e0a\u4f20\u8fdb\u5ea6\uff1a"+t+"%")}})),s.addEventListener("load",(e=>{console.log("\u4e0a\u4f20\u5b8c\u6210"),n(`${ee}/${a}`)})),s.addEventListener("error",(e=>{console.log("\u4e0a\u4f20\u51fa\u9519")})),s.addEventListener("abort",(e=>{console.log("\u4e0a\u4f20\u53d6\u6d88")})),s.open("POST",`/wmapi/upload/${t}/${ee}`),s.send(r)}}))})],[D,U]=(0,r.useState)(""),[q,M]=(0,r.useState)([]),[Y,_]=(0,r.useState)({}),[z,G]=(0,r.useState)(!1),[J,X]=(0,r.useState)(""),[B,Q]=(0,r.useState)(!1),[V,Z]=(0,r.useState)(""),[ee,te]=(0,r.useState)(""),[ne,oe]=(0,r.useState)(!1),[re,ae]=s.Ay.useMessage(),se=(0,r.useRef)(V),ie=(0,r.useRef)(ee);(0,r.useEffect)((()=>{se.current=V}),[V]),(0,r.useEffect)((()=>{ie.current=ee}),[ee]),(0,r.useEffect)((()=>{const e=e=>{const t=e.target.closest(".copy-btn, .inline-copy-btn");if(t){const e=t.getAttribute("data-code");navigator.clipboard.writeText(e).then((()=>{t.textContent="\u2705",setTimeout((()=>{t.textContent="\ud83d\udccb"}),1500)}))}};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[V]);const ce=()=>{fetch("/wmapi/search-detail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:t,query:D})}).then((e=>e.json())).then((e=>{e.ok?(M(e.data),e.data&&de(e.data[0])()):re.open({type:"error",content:e.msg})}))};(0,r.useEffect)(ce,[]);const le=()=>{fetch(`/wmapi/update-markdown/${t}/${ie.current}`,{method:"POST",headers:{"Content-Type":"application/text"},body:se.current}).then((e=>e.json())).then((e=>{e.ok?re.open({type:"success",content:"\u4fdd\u5b58\u6210\u529f"}):re.open({type:"error",content:e.msg})}))},de=e=>()=>{e&&(te(e),fetch(`/${t}/${e}.md?_t=${Date.now()}`,{method:"GET",headers:{"Cache-Control":"no-cache"}}).then((e=>e.text())).then((e=>{Z(e),oe(!0)})))};return(0,O.jsxs)(O.Fragment,{children:[ae,(0,O.jsx)(i.A,{title:"\u65b0\u5efa\u6587\u6863",open:z,onOk:()=>{fetch(`/wmapi/new-markdown/${t}/${Y.mdname}`,{method:"POST",headers:{"Content-Type":"application/text"},body:"## \u64cd\u4f5c\u4ecb\u7ecd\n* Ctrl+S\u4fdd\u5b58\n* \u56fe\u7247\u652f\u6301\u590d\u5236\u7c98\u8d34\u3001\u62d6\u62fd"}).then((e=>e.json())).then((e=>{e.ok?(ce(),G(!1)):re.open({type:"error",content:e.msg})}))},onCancel:()=>{G(!1)},children:(0,O.jsx)(c.A,{placeholder:"\u6587\u6863\u540d\u79f0",value:Y.mdname,onChange:e=>{_({mdname:e.target.value})}})}),(0,O.jsx)(i.A,{title:"\u52a0\u89e3\u5bc6",open:B,onOk:()=>{Q(!1)},onCancel:()=>{Q(!1)},children:(0,O.jsxs)(l.A,{direction:"vertical",children:[(0,O.jsx)(c.A.Password,{placeholder:"\u5bc6\u7801",value:J,onChange:e=>{X(e.target.value)}}),(0,O.jsxs)(l.A,{children:[(0,O.jsx)(d.Ay,{type:"primary",onClick:()=>{var e=P().AES.encrypt(V,J).toString();Z(e)},children:"\u52a0\u5bc6"}),(0,O.jsx)(d.Ay,{onClick:()=>{var e=P().AES.decrypt(V,J).toString(P().enc.Utf8);Z(e)},children:"\u89e3\u5bc6"})]})]})}),(0,O.jsxs)(a.A,{className:"layout",children:[(0,O.jsx)(F,{className:"header",children:(0,O.jsxs)(l.A,{children:[t,(0,O.jsx)(d.Ay,{icon:(0,O.jsx)(m.A,{}),onClick:()=>{window.location.href="/"},children:"\u9996\u9875"}),(0,O.jsxs)(l.A.Compact,{style:{width:"100%"},children:[(0,O.jsx)(c.A,{onKeyDown:e=>{"Enter"===e.code&&ce()},value:D,placeholder:"\u5173\u952e\u8bcd",onChange:e=>U(e.target.value)}),(0,O.jsx)(d.Ay,{onClick:ce,icon:(0,O.jsx)(x.A,{}),children:"\u641c\u7d22"})]}),(0,O.jsx)(d.Ay,{icon:(0,O.jsx)(f.A,{}),onClick:()=>{G(!0)},children:"\u65b0\u5efa\u6587\u6863"}),(0,O.jsx)(d.Ay,{icon:(0,O.jsx)(j.A,{}),onClick:()=>{window.open(`/wmapi/export/${t}`)},children:"\u5bfc\u51fa\u5206\u7ec4"}),(0,O.jsx)(h.A,{title:"\u5220\u9664\u5206\u7ec4",description:"\u786e\u8ba4\u5220\u9664\u5206\u7ec4\uff1f",onConfirm:e=>{fetch(`/wmapi/del-group/${t}`,{method:"DELETE"}).then((e=>e.text())).then((e=>{window.location.href="/"}))},onCancel:e=>{},okText:"\u662f",cancelText:"\u5426",children:(0,O.jsx)(d.Ay,{danger:!0,icon:(0,O.jsx)(y.A,{}),children:"\u5220\u9664\u5206\u7ec4"})})]})}),(0,O.jsx)(I,{className:"content",children:(0,O.jsxs)(p.A,{children:[(0,O.jsx)(p.A.Panel,{defaultSize:"15%",max:"70%",children:(0,O.jsx)(u.A,{style:{height:"750px"},dataSource:q,renderItem:e=>(0,O.jsx)(u.A.Item,{children:(0,O.jsx)(d.Ay,{type:"link",onClick:de(e),children:e})})})}),(0,O.jsx)(p.A.Panel,{children:ne?(0,O.jsxs)(a.A,{children:[(0,O.jsx)(F,{style:R,children:(0,O.jsxs)(a.A,{style:{backgroundColor:"#fff"},children:[(0,O.jsx)(I,{children:(0,O.jsx)("h1",{children:ee})}),(0,O.jsx)(W,{width:"40%",style:{backgroundColor:"#fff"},children:(0,O.jsxs)(l.A,{children:[(0,O.jsx)(d.Ay,{icon:(0,O.jsx)(g.A,{}),type:"primary",onClick:le,children:"\u4fdd\u5b58"}),(0,O.jsx)(d.Ay,{icon:(0,O.jsx)(A.A,{}),onClick:()=>{Q(!0)},children:"\u52a0\u89e3\u5bc6"}),(0,O.jsx)(d.Ay,{icon:(0,O.jsx)(j.A,{}),onClick:()=>{window.open(`/wmapi/export/${t}/${ee}`)},children:"\u5bfc\u51fa"}),(0,O.jsx)(h.A,{title:"\u5220\u9664\u6587\u7ae0",description:"\u786e\u8ba4\u5220\u9664\u6587\u6863\uff1f",onConfirm:e=>{te(""),fetch(`/wmapi/del-markdown/${t}/${ee}`,{method:"DELETE"}).then((e=>e.text())).then((e=>{Z(""),ce()}))},onCancel:e=>{},okText:"\u662f",cancelText:"\u5426",children:(0,O.jsx)(d.Ay,{danger:!0,icon:(0,O.jsx)(y.A,{}),children:"\u5220\u9664"})})]})})]})}),(0,O.jsx)(I,{children:(0,O.jsx)(S.K,{value:V,plugins:n,onChange:e=>{Z(e)},editorConfig:{lineNumbers:!0,autofocus:!1,extraKeys:{"Ctrl-S":()=>(le(),!0)}},locale:b})})]}):(0,O.jsx)(O.Fragment,{})})]})})]})]})}},50477:()=>{},73743:()=>{}}]);
//# sourceMappingURL=333.9034d8d9.chunk.js.map